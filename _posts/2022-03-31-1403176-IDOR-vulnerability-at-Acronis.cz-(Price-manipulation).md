---
title:  "IDOR vulnerability at Acronis.cz(Price manipulation) - $400 리뷰"
layout: single
date: 2022-03-31T21:20:00+09:00
last_modified_at: 2022-03-31
category: Hacking
---

<https://hackerone.com/reports/1403176>  
원본 링크

# IDOR vulnerability (Price manipulation)
### 요약
IDOR(Insecure Direct Object Reference)은 서버로 요청하는 메시지의 URL이나 파라미터를 변경하여 정상적이지 않은 기능을 수행하는 공격 기법이다. 쇼핑몰에서 구매를 할 때 사용자가 요청을 가로채 가격을 바꾸었을 때 서버가 이를 제대로 검증하지 않는다면 가격을 변경하여 결제할 수 있다.  

### 재현
1. https://acronis.cz에 방문한다.
2. 구매할 제품을 고르고 주문 정보를 입력한다. (가격 2379)  
![order](/assets/img/2022-03-31-1403176-IDOR-vulnerability-at-Acronis.cz-(Price-manipulation)/1.png){: .center}  
3. Burp Suite를 사용하여 Intercept 하고 POST 요청에서 **가격을 수정**하고 Forward한다.  
![proxy intercept](/assets/img/2022-03-31-1403176-IDOR-vulnerability-at-Acronis.cz-(Price-manipulation)/2.png){: .center}  
4. 결제 페이지에서 변경된 가격이 적용된다.  
![good](/assets/img/2022-03-31-1403176-IDOR-vulnerability-at-Acronis.cz-(Price-manipulation)/3.png){: .center}  
(가격을 0으로 바꾸면 적용이 안되지만 1부터는 유효한 요청으로 판단한다)
  
  
### 현재 상태
지금은 똑같이 가격을 변경해도 적용이 안 되는 모습을 볼 수 있다.  
![nice](/assets/img/2022-03-31-1403176-IDOR-vulnerability-at-Acronis.cz-(Price-manipulation)/4.png){: .center}  
  
매개변수가 하나 더 추가됐는데 서버가 item id를 받아서 서버 내의 가격으로 결제를 요청한다.  
![sad](/assets/img/2022-03-31-1403176-IDOR-vulnerability-at-Acronis.cz-(Price-manipulation)/5.png){: .center}  
  
그래서 가격을 변경하고 id도 바꾸면 바뀐 제품 id의 가격으로 결제를 요청한다.  
![nice](/assets/img/2022-03-31-1403176-IDOR-vulnerability-at-Acronis.cz-(Price-manipulation)/6.png){: .center}  
  
![nice](/assets/img/2022-03-31-1403176-IDOR-vulnerability-at-Acronis.cz-(Price-manipulation)/7.png){: .center}  




### 생각해볼 점
이에 Bounty로 $400이 지급되었다.  
새로운 매개변수인 제품 id를 만들어서 가격을 조작하지 못하게 검증하여 문제를 해결했다.  
  
[Business Logic Flaw in the subscription of the Dragon app - $250 리뷰](https://jaemin8852.github.io/hacking/1505189-Business-Logic-Flaw-in-the-subscription-of-the-Dragon-app/)는 실제 결제 시스템에 문제를 주지 않았지만, 이번에는 실제로 경제적 타격을 입힐 수 있었기에 꽤 심각한 문제였다. 사용자는 손쉽게 요청을 바꿀 수 있기 때문에 검증을 잘 해주는 게 중요하다.